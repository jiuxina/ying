# 调试功能使用指南

## 功能概述

调试功能是一个强大的开发和诊断工具，可以帮助您实时查看应用的运行状态、日志信息和系统详情。该功能通过悬浮窗的方式展示，不会干扰应用的正常使用。

## 主要特性

### 1. 应用日志监控
- 实时显示应用内部的所有日志消息
- 支持四种日志级别：
  - **Info** (信息) - 绿色标识
  - **Warning** (警告) - 橙色标识  
  - **Error** (错误) - 红色标识
  - **Debug** (调试) - 青色标识
- 最多保存 500 条日志记录
- 支持清空日志功能

### 2. 路由导航追踪
- 记录应用内所有页面的导航历史
- 显示导航时间和目标路由
- 最多保存 50 条导航记录
- 支持清空导航历史

### 3. 系统信息查看
- 操作系统信息
- 平台版本
- Dart 版本
- 处理器数量
- 系统语言
- 应用生命周期状态

## 使用方法

### 启用调试模式

1. 打开应用设置页面
2. 滚动到 "其他" 部分
3. 点击 "调试功能"
4. 开启 "启用调试模式" 开关

### 显示悬浮窗

1. 确保调试模式已启用
2. 点击 "打开悬浮窗" 选项
3. 如果是首次使用，系统会请求悬浮窗权限
4. 授予权限后，悬浮窗会自动显示

### 悬浮窗操作

- **移动悬浮窗**: 长按并拖动悬浮窗到任意位置
- **切换标签页**: 点击顶部的 "日志"、"路由"、"系统" 标签
- **清空记录**: 在对应标签页点击 "清空" 按钮
- **刷新信息**: 在系统标签页点击 "刷新系统信息" 按钮
- **关闭悬浮窗**: 返回调试设置页面，点击 "关闭悬浮窗"

## 技术实现

### 核心组件

1. **DebugService** - 调试数据收集服务
   - 单例模式设计
   - 日志收集和管理
   - 路由历史记录
   - 系统信息采集
   - 应用状态监控

2. **DebugOverlayWidget** - 悬浮窗 UI
   - 三个标签页展示不同类型的信息
   - 实时更新数据
   - 可拖动和调整大小

3. **DebugSettingsScreen** - 调试设置页面
   - 开关调试模式
   - 管理悬浮窗显示
   - 查看调试统计信息
   - 执行调试操作

### 权限要求

- **SYSTEM_ALERT_WINDOW** - 显示悬浮窗所需的系统权限
- 在 Android 6.0+ 需要用户手动授予

### 性能考虑

- 日志和路由历史都设有上限，防止内存溢出
- 只在调试模式启用时才收集和存储数据
- 悬浮窗关闭后自动停止数据刷新

## 注意事项

1. **隐私安全**
   - 调试日志可能包含敏感信息
   - 建议仅在开发和测试环境中使用
   - 不要在生产环境中启用调试模式

2. **电量消耗**
   - 悬浮窗会持续运行，可能增加电量消耗
   - 使用完毕后记得关闭悬浮窗

3. **权限管理**
   - 某些设备需要在系统设置中手动允许悬浮窗权限
   - 如果权限被拒绝，悬浮窗将无法显示

## 常见问题

**Q: 为什么悬浮窗无法显示？**
A: 请检查系统设置中是否已授予应用悬浮窗权限。

**Q: 日志记录会影响应用性能吗？**
A: 日志记录对性能的影响很小，但建议在不需要时关闭调试模式。

**Q: 可以导出调试日志吗？**
A: 当前版本不支持导出，可以通过截图保存重要信息。

**Q: 悬浮窗可以调整大小吗？**
A: 当前版本悬浮窗大小固定为 350x600，未来版本可能支持自定义大小。

## 开发者信息

如需了解更多技术细节或报告问题，请访问项目仓库：
https://github.com/jiuxina/ying

---

*最后更新: 2026-02-14*
