# 本地通知配置指南

## 快速开始

为了让「萤」的提醒通知正常工作，请完成以下配置：

### 1️⃣ 允许通知权限

首次使用时，应用会自动请求通知权限，请点击「允许」。

如果错过了，可以手动设置：
- **设置** → **应用** → **萤** → **通知** → **允许**

### 2️⃣ 允许精确闹钟

Android 12+ 系统需要此权限来确保通知准时送达：
- **设置** → **应用** → **特殊访问权限** → **闹钟和提醒** → **萤** → **允许**

### 3️⃣ 关闭电池优化 ⭐重要

这是最重要的配置！可以防止系统杀掉后台进程：

#### 方法一：在应用内请求
1. 打开「萤」
2. 进入 **设置** → **通知设置**
3. 点击「请求电池优化豁免」按钮
4. 在弹出的系统页面中选择「萤」→「不限制」

#### 方法二：手动设置
- **设置** → **应用** → **萤** → **电池** → **不限制**
- 或 **设置** → **电池** → **应用耗电管理** → **萤** → **允许后台活动**

### 4️⃣ 开启自启动（国产手机必须！）

不同品牌手机的设置路径：

#### 小米手机（MIUI）
- **设置** → **应用设置** → **应用管理** → **萤** → **自启动** → **开启**
- **设置** → **应用设置** → **应用管理** → **萤** → **省电策略** → **无限制**

#### 华为手机（HarmonyOS/EMUI）
- **设置** → **应用** → **应用启动管理** → **萤** → **手动管理** → **全部开启**
- **设置** → **电池** → **应用启动管理** → **萤** → **允许自启动、允许关联启动、允许后台活动**

#### OPPO手机（ColorOS）
- **设置** → **应用管理** → **应用列表** → **萤** → **自启动** → **开启**
- **设置** → **电池** → **应用耗电保护** → **萤** → **关闭**

#### vivo手机（OriginOS）
- **设置** → **应用与权限** → **权限管理** → **自启动** → **萤** → **开启**
- **设置** → **电池** → **后台高耗电** → **萤** → **允许后台高耗电**

#### 三星手机（One UI）
- **设置** → **电池和设备维护** → **电池** → **后台使用限制** → 从列表中移除「萤」
- **设置** → **应用** → **萤** → **电池** → **电池使用情况** → **不受限制**

## 检查配置是否生效

1. 打开「萤」应用
2. 进入 **设置** → **通知设置**
3. 查看状态：
   - ✅ 通知服务：已初始化
   - ✅ 通知权限：已授予
   - ✅ 精确闹钟权限：已授予
   - ✅ 电池优化豁免：已豁免
   - 📋 待处理通知：X 个

所有状态都显示绿色 ✅ 就说明配置正确！

## 测试通知是否工作

1. 创建一个新的倒数日
2. 设置一个提醒（比如1分钟后）
3. 点击保存
4. 返回桌面（不要杀掉应用）
5. 等待1分钟
6. 如果收到通知，说明配置成功！✨

## 系统重启后怎么办？

**不用担心！**

- 系统重启后，只需打开「萤」应用一次
- 应用会自动恢复所有通知
- 之后即使关闭应用，通知也会正常触发

## 常见问题

### ❓ 为什么没收到通知？

1. **检查权限** - 进入「设置 → 通知设置」确认所有权限已授予
2. **关闭省电模式** - 某些手机的省电模式会限制后台应用
3. **不要清理后台** - 使用手机管家等工具清理后台可能会杀掉应用
4. **定期打开应用** - 建议至少每周打开一次应用

### ❓ 通知不准时怎么办？

- 确保「精确闹钟权限」已授予
- 关闭电池优化（最重要！）
- 不要使用手机管家的深度清理功能

### ❓ 重启后通知消失了？

- 重启后打开「萤」应用一次即可自动恢复
- 如果仍未恢复，进入事件编辑页面重新保存一次

### ❓ 小米/华为等手机无法收到通知？

国产手机对后台限制特别严格，必须：
1. ✅ 关闭电池优化
2. ✅ 开启自启动
3. ✅ 允许后台活动
4. ✅ 关闭省电策略
5. ⚠️ 不要使用手机管家清理「萤」

### ❓ 应用关闭后还能收到通知吗？

可以！只要完成上述配置，即使应用完全关闭（从后台划掉），通知也会准时送达。

### ❓ 需要联网吗？

不需要！「萤」的通知完全本地化，不需要网络连接。即使飞行模式下也能正常工作。

## 技术说明

### 为什么需要这些权限？

- **通知权限** - 让应用能够显示通知
- **精确闹钟权限** - 确保通知准时触发（Android 12+）
- **电池优化豁免** - 防止系统为了省电而杀掉应用
- **自启动权限** - 允许开机后自动恢复通知（国产手机）

### 隐私说明

「萤」使用的是**本地通知**，不是推送通知：
- ✅ 所有数据保存在您的手机上
- ✅ 不会上传到任何服务器
- ✅ 不需要注册账号
- ✅ 完全保护您的隐私

### 与推送通知的区别

| 特性 | 本地通知（萤使用） | 推送通知（其他应用） |
|------|------------------|-------------------|
| 需要网络 | ❌ 不需要 | ✅ 需要 |
| 需要服务器 | ❌ 不需要 | ✅ 需要 |
| 数据上传 | ❌ 完全本地 | ⚠️ 上传到服务器 |
| 隐私性 | ✅ 最高 | ⚠️ 较低 |
| 适合场景 | 定时提醒 | 实时消息 |

## 需要帮助？

如果遇到问题：
1. 查看本指南的「常见问题」部分
2. 进入「设置 → 通知设置」检查权限状态
3. 在 GitHub 提交 Issue 或联系开发者

---

**提示**：完成所有配置后，建议创建一个测试通知（1分钟后），确认通知能正常工作。✨
