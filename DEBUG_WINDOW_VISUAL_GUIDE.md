# Debug Floating Window - Visual Guide

## UI Layout

```
┌─────────────────────────────────────────┐
│  🐛 调试窗口          🔄  ➖  ✕        │  ← Header (可拖动)
├─────────────────────────────────────────┤
│    日志    │  通知   │   权限          │  ← Tabs
├─────────────────────────────────────────┤
│                                         │
│  🔍 [搜索日志...]              🗑       │  ← Search Bar
│                                         │
│  [全部] [通知🔔] [权限🔐] [时区🌏]...   │  ← Filters
│  ─────────────────────────────────────  │
│                                         │
│  ℹ️ 14:28:17.53  开始初始化通知服务... │
│  🌏 14:28:17.54  时区设置成功: UTC+8    │
│  ✅ 14:28:17.55  通知服务初始化成功     │
│  🔐 14:28:17.56  通知权限已授予         │
│  🔐 14:28:17.57  精确闹钟权限已授予     │
│  📅 14:28:18.12  创建事件: 生日提醒     │
│  🔔 14:28:18.13  调度通知: 生日提醒     │
│  ✅ 14:28:18.14  通知已调度: 生日提醒   │  ← Log Entries
│  📅 14:28:20.45  更新事件: 纪念日       │
│  🔔 14:28:20.46  开始调度事件通知...    │
│  ⚠️ 14:28:20.47  提醒时间已过，跳过     │
│  📅 14:28:25.78  删除事件: 旧事件       │
│  ✅ 14:28:25.79  事件删除成功           │
│                                         │
│  (长按日志可复制到剪贴板)               │
│                                         │
└─────────────────────────────────────────┘
```

## Notification Tab Layout

```
┌─────────────────────────────────────────┐
│  🐛 调试窗口          🔄  ➖  ✕        │
├─────────────────────────────────────────┤
│    日志    │ [通知] │   权限          │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │ 📊 通知队列统计                 │   │
│  │                                 │   │
│  │ 待处理通知数: 3                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🔔  生日提醒              📋    │   │
│  │ ID: 1234567890                  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🔔  纪念日提醒            📋    │   │
│  │ ID: 1234567891                  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🔔  重要会议              📋    │   │
│  │ ID: 1234567892                  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  (下拉刷新)                             │
└─────────────────────────────────────────┘
```

## Permission Tab Layout

```
┌─────────────────────────────────────────┐
│  🐛 调试窗口          🔄  ➖  ✕        │
├─────────────────────────────────────────┤
│    日志    │  通知   │ [权限]         │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │ 🔔  通知权限            ✅      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ⏰  精确闹钟权限        ✅      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ⚠️  警告                        │   │
│  │                                 │   │
│  │ (暂无警告)                      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 💡 建议                         │   │
│  │                                 │   │
│  │ 1. 为确保后台通知正常工作，     │   │
│  │    请关闭电池优化               │   │
│  │                                 │   │
│  │ 2. 部分手机需要开启自启动权限   │   │
│  └─────────────────────────────────┘   │
│                                         │
│  (下拉刷新)                             │
└─────────────────────────────────────────┘
```

## Minimized State

```
┌─────────────────────────┐
│ 🐛 调试窗口       ✕    │  ← 最小化状态（点击展开）
└─────────────────────────┘
```

## Access Point (FAB on Home Screen)

```
              首页
    ┌─────────────────┐
    │                 │
    │   事件列表...   │
    │                 │
    │                 │
    │                 │
    │                 │
    │              ⊕  │ ← FAB
    │          ┌─────┐│
    │          │🐛 调试││ ← Debug button (仅调试模式)
    │          │📅 日历││
    │          │📦 归档││
    │          │➕ 添加││
    └─────────┴─────┴─┘
```

## Feature Flow

```
用户操作流程:
┌────────────────────┐
│  1. 点击 FAB      │
└──────┬─────────────┘
       │
       v
┌────────────────────┐
│  2. 点击调试按钮  │  (仅调试模式可见)
└──────┬─────────────┘
       │
       v
┌────────────────────┐
│  3. 悬浮窗弹出    │
└──────┬─────────────┘
       │
       v
┌────────────────────────────────────────┐
│  4. 选择标签页                         │
│     • 日志 - 查看实时日志              │
│     • 通知 - 检查通知队列              │
│     • 权限 - 查看权限状态              │
└──────┬─────────────────────────────────┘
       │
       v
┌────────────────────┐
│  5. 使用功能      │
│     • 搜索日志    │
│     • 筛选类型    │
│     • 复制日志    │
│     • 查看详情    │
│     • 刷新数据    │
└──────┬─────────────┘
       │
       v
┌────────────────────┐
│  6. 关闭窗口      │
│     • 点击 X      │
│     • 点击背景    │
└────────────────────┘
```

## Data Flow

```
应用运行时:
┌──────────────────────────────────────────┐
│  App 运行时事件                           │
│  • 通知初始化                             │
│  • 权限请求                               │
│  • 事件创建/更新/删除                     │
│  • 通知调度                               │
│  • 时区配置                               │
└──────────┬───────────────────────────────┘
           │
           v
┌──────────────────────────────────────────┐
│  DebugLogger (单例)                       │
│  • 接收日志调用                           │
│  • 判断是否为调试模式                     │
│  • 存储日志（最多500条）                  │
│  • 通知监听器                             │
└──────────┬───────────────────────────────┘
           │
           v
┌──────────────────────────────────────────┐
│  DebugFloatingWindow                      │
│  • 监听日志变化                           │
│  • 更新 UI                                │
│  • 显示日志/通知/权限                     │
│  • 提供交互功能                           │
└──────────────────────────────────────────┘
```

## Log Type Icons

```
类型              图标    用途
─────────────────────────────────────
info             ℹ️      一般信息
success          ✅      成功操作
warning          ⚠️      警告信息
error            ❌      错误信息
notification     🔔      通知相关
permission       🔐      权限相关
timezone         🌏      时区配置
event            📅      事件操作
```

## Code Integration Points

```
NotificationService
├─ initialize()          → 记录初始化、时区设置
├─ requestPermissions()  → 记录权限请求结果
├─ scheduleEventReminders() → 记录调度开始
└─ _scheduleReminder()   → 记录每个通知调度

EventsProvider
├─ insertEvent()         → 记录事件创建
├─ updateEvent()         → 记录事件更新
└─ deleteEvent()         → 记录事件删除

HomeScreen
└─ _buildExpandableFAB() → 添加调试按钮入口
```

## Memory Management

```
日志存储机制:
┌────────────────────────────────────┐
│  新日志到达                         │
└──────┬─────────────────────────────┘
       │
       v
┌────────────────────────────────────┐
│  检查日志数量                       │
│  当前: X 条                         │
│  最大: 500 条                       │
└──────┬─────────────────────────────┘
       │
       v
    ┌──┴──┐
    │ X < 500? │
    └──┬──┬──┘
       │  │
  YES  │  │ NO
       │  │
       v  v
    直接 删除
    添加 最旧
         日志
```

## Debug vs Release Mode

```
Debug Mode (kDebugMode = true)
┌────────────────────────────────────┐
│  • 调试按钮可见                     │
│  • 日志正常记录                     │
│  • 悬浮窗可以打开                   │
│  • 所有功能可用                     │
└────────────────────────────────────┘

Release Mode (kDebugMode = false)
┌────────────────────────────────────┐
│  • 调试按钮不显示                   │
│  • 日志不记录（直接返回）           │
│  • 悬浮窗无法打开                   │
│  • 零性能影响                       │
└────────────────────────────────────┘
```
